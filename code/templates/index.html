<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Accueil â€“ Eau France</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    #map {
      height: 500px;
      border-radius: 1rem;
      margin-top: 2rem;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
  </style>
</head>
<body class="bg-gray text-gray">

  <!-- Header -->
  <header class="header">
    <div class="container header-content">
      <a href="/" class="logo">
        <span class="logo-icon">ðŸ’§</span>
        Eau France
      </a>
      <ul class="nav-menu">
        <li><a class="nav-link active" href="/">Accueil</a></li>
        <li><a class="nav-link" href="/graphique_global">Graphique</a></li>
      </ul>
    </div>
  </header>

  <!-- Main -->
  <main class="container mt-5 text-center">
    <h1 class="text-primary mb-4">Bienvenue sur Eau France</h1>
    <p class="text-gray mb-4">
      Explorez les stations de mesure, consultez les observations et campagnes en un clic.
    </p>

    <!-- Filtrage -->
    <form method="get" class="d-flex gap-3 justify-center mb-4 flex-wrap">
      <input type="text" name="search" placeholder="Rechercher une station..." value="{{ request.args.get('search', '') }}" class="form-input" />

      <select name="region" class="form-select">
        <option value="">-- RÃ©gion --</option>
        {% for r in regions %}
          <option value="{{ r }}" {% if request.args.get("region") == r %}selected{% endif %}>{{ r }}</option>
        {% endfor %}
      </select>

      <select name="departement" class="form-select">
        <option value="">-- DÃ©partement --</option>
        {% for d in departements %}
          <option value="{{ d }}" {% if request.args.get("departement") == d %}selected{% endif %}>{{ d }}</option>
        {% endfor %}
      </select>

      <button type="submit" class="btn btn-primary">Filtrer</button>
      <a href="/" class="btn btn-outline">RÃ©initialiser</a>
    </form>

    <!-- Carte -->
    <div id="map"></div>
  </main>

  <!-- Footer -->
  <footer class="bg-primary text-white text-center p-4 mt-5">
    SAE 2.01 / 2.04 â€“ Projet de visualisation â€“ BUT Informatique
  </footer>

  <!-- Leaflet -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    const map = L.map('map').setView([46.5, 2.5], 6);

    L.tileLayer('https://{s}.tile.openstreetmap.fr/osmfr/{z}/{x}/{y}.png', {
      attribution: 'Â© OpenStreetMap contributors â€“ OSM France',
      minZoom: 5,
      maxZoom: 18
    }).addTo(map);

    {% for station in stations %}
      {% if station.latitude and station.longitude %}
        L.marker([{{ station.latitude }}, {{ station.longitude }}])
          .addTo(map)
          .bindPopup(`<strong>{{ station.libelle_station }}</strong><br>
                      {{ station.libelle_commune }}<br>
                      <a href='/station/{{ station.code_station }}'>Voir la station</a>`);
      {% endif %}
    {% endfor %}
  </script>
</body>
</html>
